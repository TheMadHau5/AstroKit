<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>AstroKit</title>
        <link rel="stylesheet" href="/static/dist/output.css" />
    </head>
    <body class="p-6 bg-gray-600 flex flex-col min-h-screen">
        <section
            class="text-gray-300 bg-gray-900 body-font rounded-2xl justify-center items-center pb-10"
        >
            <div class="px-4 py-10 mx-auto">
                <div class="flex flex-wrap">
                    <div class="p-4 lg:w-1/3 items-center justify-center">
                        <div
                            class="h-full bg-gray-800 space-y-4 bg-opacity-40 px-8 py-16 rounded-lg overflow-hidden text-center relative items-center justify-center"
                        >
                            <h3 id="reps" class="text-xl text-gray-300">
                                Reps: 0/10
                            </h3>
                            <progress
                                class="progress h-10 w-full items-center mx-auto justify-center"
                                id="progress"
                                value="0"
                                max="10"
                            ></progress>
                        </div>
                    </div>
                    <div class="p-4 lg:w-1/3 items-center justify-center">
                        <div
                            class="h-full bg-gray-800 bg-opacity-40 px-8 py-16 rounded-lg overflow-hidden text-center relative items-center justify-center"
                        >
                            <h1
                                class="title-font text-4xl font-semibold text-white mb-3"
                                id="title"
                            >
                                Exercise Title
                            </h1>
                            <div
                                class="flex flex-row items-center justify-center text-center gap-x-4"
                            >
                                <h3 id="stance" class="text-xl text-gray-300">
                                    Please wait..
                                </h3>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 lg:w-1/3 items-center justify-center">
                        <div
                            class="h-full bg-gray-800 bg-opacity-40 px-8 py-16 rounded-lg overflow-hidden text-center relative"
                        >
                            <img
                                src="https://www.pngplay.com/wp-content/uploads/8/Space-Astronaut-Transparent-File.png"
                                class="w-1/4 mx-auto"
                            />
                        </div>
                    </div>
                </div>
            </div>
            <div
                class="p-2 w-[90%] mx-auto flex space-x-20 items-center justify-center"
            >
                <div class="w-1/4 flex flex-col space-y-5">
                    <button
                        class="p-2 bg-gray-600 text-white scale-110 ease-in-out transition duration-200 inline-flex rounded-xl items-center justify-between gap-2"
                    >
                        <a>View Helmet</a>
                        <input type="checkbox" class="toggle toggle-success" />
                    </button>
                    <button
                        class="p-2 bg-gray-600 text-white scale-110 ease-in-out transition duration-200 inline-flex rounded-xl items-center justify-between gap-2"
                    >
                        <a>Render Wireframe</a>
                        <input
                            type="checkbox"
                            class="toggle toggle-success"
                            onchange="toggleLandmarks()"
                        />
                    </button>
                    <button
                        class="p-2 bg-gray-600 text-white scale-110 ease-in-out transition duration-200 inline-flex rounded-xl items-center justify-between gap-2"
                    >
                        <a class="mr-auto">Switch Exercise</a>
                        <input
                            type="checkbox"
                            class="toggle toggle-success ml-auto"
                            onchange="setAuto()"
                        />
                    </button>
                    <div
                        class="p-2 bg-gray-600 text-white scale-110 text-center ease-in-out transition duration-200 rounded-xl inline-block items-center justify-center gap-2"
                    >
                        <a class="text-center mb-2">Reps per Set</a>
                        <input
                            type="range"
                            min="5"
                            max="30"
                            value="10"
                            class="range"
                            step="5"
                            onchange="repsPerSet(this.value)"
                        />
                        <div class="w-full flex justify-between text-xs px-2">
                            <span>5</span>
                            <span>10</span>
                            <span>15</span>
                            <span>20</span>
                            <span>25</span>
                            <span>30</span>
                        </div>
                    </div>
                </div>
                <div
                    class="w-1/2 bg-gray-800 bg-opacity-40 px-4 py-10 mb-2 rounded-lg overflow-hidden text-center relative flex"
                >
                    <img
                        src="{{ url_for('video') }}"
                        class="w-[90%] mx-auto rounded-2xl -scale-x-100"
                    />
                </div>
                <div class="w-1/4 flex flex-col space-y-10">
                    <button
                        class="px-4 py-2 bg-red-500 text-white hover:scale-110 ease-in-out transition duration-200 rounded-xl"
                        onclick="prevButton()"
                    >
                        Previous
                    </button>
                    <button
                        class="px-4 py-2 bg-green-500 text-white hover:scale-110 ease-in-out transition duration-200 rounded-xl"
                        onclick="nextButton()"
                    >
                        Next
                    </button>
                </div>
            </div>
        </section>
        <script>
            let ireps = 10;
            let exc = null;
            let auto = false;
            let landmarks_debug = false;
            let helmet = false;
            const exercises = {
                press: "Shoulder Press",
                latr: "Lateral Raises",
                curl: "Bicep Curl",
                jack: "Jumping Jack"
            };
            async function updateDirections() {
                const response = await fetch('/tick'); // Make an AJAX request to the Flask route that provides direction information
                const directionInfo = await response.json();
                let { stance, reps, exercise } = directionInfo;
                if (reps >= ireps) {
                    if (auto) return await nextButton();
                    else reps -= ireps;
                }
                document.getElementById('title').innerHTML = exercises[exercise];
                exc = exercise;
                document.getElementById('stance').innerHTML = `Stance: ${stance ? stance : 'N/A'}`;
                document.getElementById('reps').innerHTML = `Reps: ${reps}/${ireps}`;
                document.getElementById('progress').value = reps.toString();
            }

            function repsPerSet(x) {
                ireps = x;
                document.getElementById('progress').max = ireps.toString();
                updateDirections();
            }

            function nextButton () {
                const keys = [...Object.keys(exercises)];
                const index = keys.indexOf(exc);
                const next = keys[(index + 1) % keys.length];
                updateSetting({exercise: next});
            }

            function prevButton () {
                const keys = [...Object.keys(exercises)];
                const index = keys.indexOf(exc);
                const newIndex = index == 0 ? keys.length - 1 : (index - 1) % keys.length;
                const prev = keys[newIndex];
                updateSetting({exercise: prev});
            }

            function updateSetting(body) {
                fetch('/update_setting', {
                    body: JSON.stringify(body),
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }

                });

                updateDirections();
            }

            function setAuto() {
                auto = !auto;
            }

            function toggleLandmarks() {
                landmarks_debug = !landmarks_debug;
                updateSetting({landmarks_debug});
            }

            function toggleHelmet() {
                helmet = !helmet;
                updateSetting({helmet});
            }

            // Update directions every 1 second
            setInterval(updateDirections, 1000);
        </script>
    </body>
</html>
